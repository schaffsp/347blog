<!DOCTYPE html>
<html>

<head>
    <title>Blog</title>
    <link rel="stylesheet" href="week5.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script>

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(getWeather);
            } else {
                alert("Geolocation not supported by this browser");
            }
        }

        function getWeather(position) {
            let lat = position.coords.latitude;
            let long = position.coords.longitude;
            let API_KEY = "43e109265577dd984859386b76653548";
            let baseURL = `http://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${long}&appid=${API_KEY}`
            $.get(baseURL, function (res) {
                let data = res.current;
                let temp = Math.floor((data.temp - 273) * 1.8 + 32);
                let condition = data.weather[0].description;

                document.getElementById("temp").textContent = temp + "°";
                document.getElementById("condition").textContent = ", " + condition;
            })
        }

        getLocation();
    </script>
</head>

<body>
    <h1 class="post_title">Some Javascript</h1>
    <p class="post_subtitle">Week 3, 10/7/2021</p>
    <p>This week, since we have been dipping our toes into Javascript, I decided to focus on that. The Rhyming activity
        earlier this week inspired me to do something with an external API call. So, I have displayed the current
        weather and condition below this paragraph(hopefully).</p>
    <div class="weather">
        <h2 id="temp">temp</h2>
        <h3 id="condition">, condition</h3>
    </div>
    <p>
        I began by creating a method that would get the location of the user using things built into the browser. There
        is a simple alert if the browser being used does not support what I am trying to do. I tested it on Chrome, and
        Firefox without issue.
    </p>
    <p>
        Once I have the lat and long from the position, I combine it with an API key that I generated using a free
        openweathermap subscription and make a request to the openweathermap API. For some reason the weather service I
        used returns temperature in kelvin, so I subtract 273, multiply by 1.8, and add 32.
    </p>
    <blockquote>let temp = Math.floor((data.temp - 273) * 1.8 + 32);</blockquote>
    <p>From there its a simple matter of replacing the text of some HTML elements like so:</p>
    <blockquote>
        document.getElementById("temp").textContent = temp + "°";<br>
        document.getElementById("condition").textContent = ", " + condition;
    </blockquote>
    <p>
        https://codereview.stackexchange.com/questions/120106/weather-app-using-the-openweathermap-com-api<br>
        https://javascript.plainenglish.io/display-7-day-weather-forecast-with-openweather-api-aac8ba21c9e3
    </p>
    <a class="symbol" href="../index.html">
        <h3>&lt; Return</h3>
    </a>
</body>

</html>